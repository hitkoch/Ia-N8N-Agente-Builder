<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug CORS - Site Externo</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .debug-info { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .test-button { background: #022b44; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-button:hover { background: #034166; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #e8f5e8; border: 1px solid #4caf50; }
        .error { background: #ffebee; border: 1px solid #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ†Ô∏è Debug CORS - Webchat Externo</h1>
        
        <div class="debug-info">
            <h3>Informa√ß√µes do Dom√≠nio</h3>
            <p><strong>Dom√≠nio atual:</strong> <span id="current-domain"></span></p>
            <p><strong>Protocolo:</strong> <span id="current-protocol"></span></p>
            <p><strong>URL completa:</strong> <span id="current-url"></span></p>
        </div>

        <div class="debug-info">
            <h3>Testes de Conectividade</h3>
            <button class="test-button" onclick="testDirectAPI()">Testar API Direta</button>
            <button class="test-button" onclick="testCORS()">Testar CORS</button>
            <button class="test-button" onclick="clearResults()">Limpar Resultados</button>
            <div id="test-results"></div>
        </div>

        <div class="debug-info">
            <h3>Console Logs</h3>
            <p>Abra o console do navegador (F12) para ver todos os logs detalhados do webchat.</p>
        </div>
    </div>

    <!-- Webchat com URL completa do Replit -->
    <script 
        src="https://2c2fba71-5662-4346-a0fd-6a18acbd81f9-00-19ouk1snh5yj5.picard.replit.dev/js/webchat-loader.js"
        data-agent-id="2"
        data-agent-name="Debug Test"
        data-primary-color="#022b44"
        data-accent-color="#b8ec00">
    </script>

    <script>
        // Display domain info
        document.getElementById('current-domain').textContent = window.location.hostname;
        document.getElementById('current-protocol').textContent = window.location.protocol;
        document.getElementById('current-url').textContent = window.location.href;

        async function testDirectAPI() {
            const apiUrl = 'https://2c2fba71-5662-4346-a0fd-6a18acbd81f9-00-19ouk1snh5yj5.picard.replit.dev/api/webchat/2/chat';
            const resultDiv = document.getElementById('test-results');
            
            try {
                console.log('üß™ Testando API direta:', apiUrl);
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: 'teste direto do debug' }),
                    mode: 'cors'
                });

                console.log('‚úÖ Resposta recebida:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML += `<div class="result success">
                        <strong>‚úÖ API Direta: SUCESSO</strong><br>
                        Status: ${response.status}<br>
                        Resposta: ${data.response.substring(0, 100)}...
                    </div>`;
                } else {
                    resultDiv.innerHTML += `<div class="result error">
                        <strong>‚ùå API Direta: ERRO</strong><br>
                        Status: ${response.status}<br>
                        Erro: ${response.statusText}
                    </div>`;
                }
            } catch (error) {
                console.error('‚ùå Erro na API direta:', error);
                resultDiv.innerHTML += `<div class="result error">
                    <strong>‚ùå API Direta: FALHOU</strong><br>
                    Erro: ${error.message}<br>
                    Tipo: ${error.name}
                </div>`;
            }
        }

        async function testCORS() {
            const apiUrl = 'https://2c2fba71-5662-4346-a0fd-6a18acbd81f9-00-19ouk1snh5yj5.picard.replit.dev/api/webchat/2/chat';
            const resultDiv = document.getElementById('test-results');
            
            try {
                console.log('üß™ Testando CORS preflight');
                
                const response = await fetch(apiUrl, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'Content-Type'
                    }
                });

                console.log('‚úÖ CORS preflight:', response.status);
                
                resultDiv.innerHTML += `<div class="result ${response.ok ? 'success' : 'error'}">
                    <strong>${response.ok ? '‚úÖ' : '‚ùå'} CORS Preflight</strong><br>
                    Status: ${response.status}<br>
                    Headers: ${JSON.stringify(Object.fromEntries(response.headers))}
                </div>`;
            } catch (error) {
                console.error('‚ùå Erro CORS:', error);
                resultDiv.innerHTML += `<div class="result error">
                    <strong>‚ùå CORS: FALHOU</strong><br>
                    Erro: ${error.message}
                </div>`;
            }
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }
    </script>
</body>
</html>