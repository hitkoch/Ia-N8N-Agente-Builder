## Tarefa Final e Definitiva: Remover Completamente a Refer√™ncia ao Vite em Produ√ß√£o

**Diagn√≥stico:** A aplica√ß√£o est√° crashando em produ√ß√£o com o erro `ERR_MODULE_NOT_FOUND` porque o c√≥digo do backend compilado (`dist/index.js`) ainda tenta importar o pacote 'vite', que n√£o √© instalado em produ√ß√£o.

**A√ß√£o:** Modifique o arquivo `server/index.ts`. Vamos separar completamente o ponto de entrada do servidor de desenvolvimento e de produ√ß√£o para garantir que o Vite nunca seja importado no ambiente de produ√ß√£o.

**Substitua o conte√∫do completo do seu `server/index.ts` pelo c√≥digo abaixo:**

```typescript
// Conte√∫do completo e final para server/index.ts

import express from "express";
import cors from "cors";
import { registerRoutes } from "./routes";
import { setupWebhookRoutes } from "./webhook";
import { keepAliveService } from "./keep-alive";
import { webhookOptimizer } from "./webhook-optimizer";
import { whatsappMonitor } from "./services/whatsapp-monitor";
import { serveStatic } from "./vite"; // Apenas a fun√ß√£o 'serveStatic' √© segura para importar

const app = express();

// --- Configura√ß√£o dos Middlewares ---
app.use(cors({ origin: '*' }));
app.use(express.json({ limit: '50mb' }));
app.use(express.urlencoded({ limit: '50mb', extended: true }));
app.set('trust proxy', true);

// --- Fun√ß√£o Principal de Inicializa√ß√£o ---
async function startServer() {
  const server = require('http').createServer(app);

  setupWebhookRoutes(app);
  
  app.get('/health', (req, res) => {
    res.json({ status: 'ok', uptime: process.uptime() });
  });
  
  await registerRoutes(app);

  // --- L√ìGICA DE AMBIENTE CORRIGIDA E SEGURA ---
  if (process.env.NODE_ENV === "production") {
    // Em produ√ß√£o, apenas sirva os arquivos est√°ticos.
    // Nenhuma refer√™ncia ao Vite aqui.
    serveStatic(app);
    console.log("üì¶ Servindo arquivos est√°ticos para produ√ß√£o.");
  } else {
    // Em desenvolvimento, importa e configura o Vite dinamicamente.
    // Isso garante que 'vite' nunca seja parte do bundle de produ√ß√£o.
    const { setupVite } = await import("./vite");
    await setupVite(app, server);
    console.log("üå± Servidor Vite configurado para desenvolvimento.");
  }

  const port = 5000;
  server.listen({ port, host: "0.0.0.0" }, () => {
    console.log(`üöÄ Servidor rodando na porta ${port} em modo ${process.env.NODE_ENV}`);
    
    if (process.env.NODE_ENV === 'production') {
      keepAliveService.start();
      webhookOptimizer.startPeriodicWarmup();
      whatsappMonitor.start();
    }
  });
}

startServer().catch(err => {
  console.error("‚ùå Falha ao iniciar o servidor:", err);
  process.exit(1);
});